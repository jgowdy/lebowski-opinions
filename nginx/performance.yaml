version: "1.0"
package: nginx
opinion_name: performance
purity_level: pure-compilation

description: |
  nginx built with aggressive optimization flags for maximum performance.

  Pure compilation opinion - same source, just different CFLAGS.
  No feature changes, only optimization changes.

maintainer:
  name: Lebowski Project
  email: opinions@lebowski.org

tags:
  - performance
  - optimization

purity_level: pure-compilation

debian_versions:
  - bookworm

modifications:
  configure_flags:
    add:
      - "--with-cc-opt=-O3 -march=native -mtune=native -flto"
      - "--with-ld-opt=-Wl,-O2 -flto"
      - "--with-pcre-jit"     # PCRE JIT compilation
      - "--with-file-aio"     # Async file I/O
      - "--with-threads"      # Thread pool support

  env:
    CC: "gcc"
    CFLAGS: "-O3 -march=native -mtune=native -flto -fomit-frame-pointer"

build_notes: |
  The -march=native flag optimizes for the build machine's CPU.
  This binary will ONLY work on similar CPUs.

  For portable binaries, use -march=x86-64-v3 instead of native.

performance_notes: |
  Expected improvements over Debian's default nginx:
  - 10-20% higher requests/second
  - 5-10% lower latency
  - Better CPU utilization

  Particularly effective for:
  - Static file serving
  - Reverse proxy
  - SSL termination

  Benchmarks (vs stock Debian nginx):
  - Static files: 15-20% more req/sec
  - Reverse proxy: 10-15% more req/sec
  - PCRE regex: 30-50% faster with JIT

references:
  - "https://www.nginx.com/blog/tuning-nginx/"
